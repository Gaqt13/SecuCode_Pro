<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>SecuCode - Ù†Ø¸Ø§Ù… ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</title>
    <style>
        /* ... ÙƒÙˆØ¯ CSS Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„ØµÙØ­Ø© ... */
        .container {
            /* ... Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø­Ø§ÙˆÙŠØ© ... */
            max-width: 500px;
            margin: 50px auto;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-radius: 8px;
            background-color: #fff;
        }
        .error-message {
            background-color: #ffe0e0;
            color: #d32f2f;
            border: 1px solid #d32f2f;
            padding: 10px;
            margin-top: 15px;
            border-radius: 4px;
            font-weight: bold;
            display: none; /* ÙŠØªÙ… Ø¥Ø¸Ù‡Ø§Ø±Ù‡ ÙÙ‚Ø· Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ø®Ø·Ø£ */
        }
        .result-panel {
            /* ... ØªØµÙ…ÙŠÙ… Ù„ÙˆØ­Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ... */
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #eee;
        }
    </style>
</head>
<body>

    <div class="container">
        <h2>SecuCode ğŸ”</h2>
        <p>Ù†Ø¸Ø§Ù… ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</p>
        
        <input type="text" id="linkInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø°ÙŠ ØªØ´Ùƒ Ø¨Ù‡ Ù„ÙØ­ØµÙ‡ Ø£Ù…Ù†ÙŠØ§Ù‹" style="width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px;">
        
        <button id="checkButton" style="width: 100%; padding: 10px; background-color: #4A90E2; color: white; border: none; border-radius: 4px; cursor: pointer;">Ø§ÙØ­Øµ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¢Ù†</button>

        <div id="errorMessage" class="error-message"></div>

        <div id="resultPanel" class="result-panel">
            </div>
    </div>

    <script>
        document.getElementById('checkButton').addEventListener('click', async () => {
            const linkInput = document.getElementById('linkInput');
            const resultPanel = document.getElementById('resultPanel');
            const errorMessage = document.getElementById('errorMessage');
            const link = linkInput.value.trim();

            // 1. ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
            errorMessage.style.display = 'none';
            resultPanel.innerHTML = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...';
            
            if (!link) {
                errorMessage.textContent = 'âŒ ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚: Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø·. Ø­Ù‚Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† ÙØ§Ø±ØºØ§Ù‹.';
                errorMessage.style.display = 'block';
                resultPanel.innerHTML = '';
                return;
            }

            try {
                // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰ Ù†Ù‚Ø·Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© analyze ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù…
                const response = await fetch('/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ link: link })
                });

                const data = await response.json();

                // 2. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©: 
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø±Ù…Ø² Ø§Ù„Ø­Ø§Ù„Ø© 400 (Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø±Ø§Ø¨Ø·)ØŒ Ù†Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….
                if (response.status === 400) {
                    // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…
                    errorMessage.textContent = data.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨Ùƒ.';
                    errorMessage.style.display = 'block';
                    resultPanel.innerHTML = '';
                    return;
                }
                
                // 3. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ø§Ø¬Ø­Ø© Ø£Ùˆ ØªØ­Ø°ÙŠØ±Ø§Øª Ø§Ù„ØªØ­Ù„ÙŠÙ„
                if (response.status === 200) {
                    displayAnalysisResult(data);
                } else {
                    // Ø£ÙŠ Ø®Ø·Ø£ Ø¢Ø®Ø± ØºÙŠØ± 400 (Ù…Ø«Ù„ 500 Ø®Ø·Ø£ Ø¯Ø§Ø®Ù„ÙŠ ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù…)
                     errorMessage.textContent = 'âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù…: ' + (data.message || 'ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹.');
                     errorMessage.style.display = 'block';
                     resultPanel.innerHTML = '';
                }

            } catch (error) {
                console.error('Fetch Error:', error);
                errorMessage.textContent = 'âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.';
                errorMessage.style.display = 'block';
                resultPanel.innerHTML = '';
            }
        });

        // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¨Ø´ÙƒÙ„ Ù…ÙÙ†Ø¸Ù… ÙƒÙ…Ø§ ÙÙŠ ØµÙˆØ±ØªÙƒ Ø§Ù„Ø£ÙˆÙ„Ù‰
        function displayAnalysisResult(data) {
            let statusColor = data.status === 'success' ? '#4CAF50' : (data.status === 'warning' ? '#FFC107' : '#F44336');
            let statusText = data.status === 'success' ? 'âœ… Ø¢Ù…Ù† Ù†Ø³Ø¨ÙŠÙ‹Ø§' : (data.status === 'warning' ? 'âš ï¸ ÙŠØ­ØªØ§Ø¬ Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©' : 'âŒ Ø®Ø·Ø± Ù…Ø­ØªÙ…Ù„');
            
            resultPanel.innerHTML = `
                <div style="background-color: ${statusColor}; color: white; padding: 10px; border-radius: 4px; text-align: center;">
                    Ø§Ù„Ù†ØªÙŠØ¬Ø©: <strong>${statusText}</strong>
                    <br>Ù†Ù‚Ø§Ø· Ø§Ù„Ø´Ùƒ Ø§Ù„ÙƒÙ„ÙŠØ©: ${data.suspicious_points}
                </div>
                
                <h3 style="margin-top: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px;">ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</h3>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <p><strong>Ø§Ù„Ø±Ø§Ø¨Ø· Ù‚ÙŠØ¯ Ø§Ù„ÙØ­Øµ:</strong> ${data.link}</p>
                    <p><strong>ØªØµÙ†ÙŠÙ Ø§Ù„Ø®Ø·ÙˆØ±Ø©:</strong> â— ${data.risk_score}</p>
                    <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª Ø§Ù„Ù…ÙƒØªØ´ÙØ©:</strong> ${data.detected_warnings}</p>
                </div>

                <div style="margin-top: 15px; padding: 10px; background-color: #fff9c4; border: 1px solid #ffeb3b; border-radius: 4px;">
                    <p>ğŸš¨ ØªØ­Ø°ÙŠØ±Ø§Øª ØªÙØµÙŠÙ„ÙŠØ© ÙÙŠ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø©:</p>
                    <p>â€¢ ${data.page_content_warning}</p>
                </div>
            `;
        }
    </script>
</body>
</html>
